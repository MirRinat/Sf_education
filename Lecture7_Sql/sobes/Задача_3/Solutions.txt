--1
with TMP as (
select B.ID_, B.NAME_, case when A.NAME_ is null then 0 else 1 end as NAME_CNT
from CLIENTS A RIGHT JOIN CITIES B
ON A.CITY_ID_ = B.ID_)
select ID_,NAME_,sum(NAME_CNT) as COUNT_CLIENT
from TMP
GROUP BY ID_,NAME_;

--2
SELECT 
count(distinct client_id) as P_SIZE
FROM PORTFOLIO aa
WHERE date_from <= TO_DATE('04/12/2018','DD/MM/YYYY')
AND date_to >= TO_DATE('04/12/2018','DD/MM/YYYY');

--3
SELECT A.ID_ AS CLIENT_ID,
A.NAME_ AS CLIENT_NAME,
B.ID_ as CITY_ID,
B.NAME_ as CITY_NAME,
C.PRODUCT_ID,
C.DATE_FROM,
C.DATE_TO,
D.NAME_ AS NAME_PRODUCT,
D.GROUP_ AS PRODUCT_GROUP 
FROM CLIENTS 
A INNER JOIN CITIES B ON A.CITY_ID_= B.ID_
INNER JOIN PORTFOLIO C ON A.ID_=C.CLIENT_ID
INNER JOIN PRODUCTS D ON C.PRODUCT_ID=D.ID_
WHERE C.date_from <= SYSDATE
AND C.date_to >= SYSDATE;

--4
SELECT count(PRODUCT_ID) AS CNT_MOSCOW
FROM CLIENTS 
A INNER JOIN CITIES B ON A.CITY_ID_= B.ID_
INNER JOIN PORTFOLIO C ON A.ID_=C.CLIENT_ID
INNER JOIN PRODUCTS D ON C.PRODUCT_ID=D.ID_
WHERE date_from <= TO_DATE('01/01/2018','DD/MM/YYYY')
AND date_to >= TO_DATE('01/01/2018','DD/MM/YYYY')
AND B.NAME_='Msc';